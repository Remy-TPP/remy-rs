setup:
  addons:
    - plan: heroku-postgresql
      as: DATABASE
    - plan: heroku-postgresql
      as: AIRFLOW_DATABASE

build:
  docker:
    web:
      dockerfile: Dockerfile
      target: production
  config:
    ENV: production
    DATA_ROOT_DIR: /tmp/remy_rs

# release:
#   image: worker
#   command:
#     - airflow upgradedb

run:
  # web: python -m uvicorn --host="0.0.0.0" remy_rs.api.api:api
  web: bash -c "gunicorn -b "0.0.0.0" -w 4 -k uvicorn.workers.UvicornWorker remy_rs.api.api:api"
  worker:
    image: web
    command:
      - scheduler
